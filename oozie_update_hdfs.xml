<?xml version="1.0" encoding="UTF-8"?>

<!-- Oozie Workflow for UPDATING all tables from RDBMS -->

<workflow-app xmlns="uri:oozie:workflow:0.4" name="rdbms-to-hdfs-casestudy-pt1-Workflow">

		<start to="sqoop_update_1st_table"/>
		
		<!-- step 1 : update 1st table-->	
		<action name="sqoop_update_1st_table">
			<sqoop xmlns="uri:oozie:sqoop-action:0.2">
				<job-tracker>${jobTracker}</job-tracker>
				<name-node>${nameNode}</name-node>
				<configuration>
					<property>
						<name>mapred.job.queue.name</name>
						<value>${queueName}</value>
					</property>
				</configuration>
				<command>job --meta-connect jdbc:hsqldb:hsql://localhost:16000/sqoop --exec sqoop_update_table_one</command>	
			</sqoop>
			<ok to="sqoop_update_2nd_table"/>
			<error to="kill_job"/>
		</action>
		
		<!-- step 2 : update 2nd table-->	
		<action name="sqoop_update_2nd_table">
			<sqoop xmlns="uri:oozie:sqoop-action:0.2">
				<job-tracker>${jobTracker}</job-tracker>
				<name-node>${nameNode}</name-node>
				<configuration>
					<property>
						<name>mapred.job.queue.name</name>
						<value>${queueName}</value>
					</property>
				</configuration>
				<command>job --meta-connect jdbc:hsqldb:hsql://localhost:16000/sqoop --exec sqoop_update_table_two</command>	
			</sqoop>
			<ok to="sqoop_update_3rd_table"/>
			<error to="kill_job"/>
			
		</action>		<!-- step3 : update 3rd table-->	
		<action name="sqoop_update_3rd_table">
			<sqoop xmlns="uri:oozie:sqoop-action:0.2">
				<job-tracker>${jobTracker}</job-tracker>
				<name-node>${nameNode}</name-node>
				<configuration>
					<property>
						<name>mapred.job.queue.name</name>
						<value>${queueName}</value>
					</property>
				</configuration>
				<command>job --meta-connect jdbc:hsqldb:hsql://localhost:16000/sqoop --exec sqoop_update_table_three</command>		
			</sqoop>
			<ok to="sqoop_update_4th_table"/>
			<error to="kill_job"/>
			
		</action>		<!-- step 4 : update 4th table-->	
		<action name="sqoop_update_4th_table">
			<sqoop xmlns="uri:oozie:sqoop-action:0.2">
				<job-tracker>${jobTracker}</job-tracker>
				<name-node>${nameNode}</name-node>
				<configuration>
					<property>
						<name>mapred.job.queue.name</name>
						<value>${queueName}</value>
					</property>
				</configuration>
				<command>job --meta-connect jdbc:hsqldb:hsql://localhost:16000/sqoop --exec sqoop_update_table_four</command>	
			</sqoop>
			<ok to="end"/>
			<error to="kill_job"/>
		</action>
		
		<kill name="kill_job">
			<message>Job failed</message>
		</kill>		
		
	<end name="end"/>
</workflow-app>